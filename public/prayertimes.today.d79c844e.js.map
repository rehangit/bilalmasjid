{"version":3,"sources":["scripts/prayertimes.today.js"],"names":["window","onload","dateToday","Date","index","getDate","range","log","localStorage","getItem","console","frequency","parseInt","timeOptions","hour12","hour","minute","getRowData","row","date","islamicDate","day","fajarBegins","fajarJamaat","sunrise","dhurBegins","dhurJamaat","asarBegins","asarJamaat","maghribBegins","maghribJamaat","ishaBegins","ishaJamaat","islamicMonthNumber","firstJumah","secondJumah","unofficial","map","val","i","hh","mm","split","t","Number","setHours","setMinutes","toLocaleTimeString","islamicMonth","drawData","data","dateString","valid","today","tomorrow","ishraq","formatTime","time","incH","incM","replace","todaysDateStr","toISOString","toLocaleDateString","year","month","second","islamicDateStr","timeToMins","h","m","calcStyles","begins","jamaat","before","after","next","style","now","slice","from","jamaatTime","to","push","join","sehriClass","dhuhurClass","asarClass","maghribClass","ishaClass","legendClass","includes","table","document","getElementById","innerHTML","querySelector","classList","remove","stored","JSON","parse","isValid","params","URL","location","searchParams","sheetId","get","sheetName","key","error","urlToFetch","fetchFreshDataAndUpdate","render","fetch","then","res","json","values","setItem","stringify","catch","setInterval"],"mappings":";;;AAEA,aAFA,QAAA,mCAEAA,OAAOC,OAAS,MACRC,MAAAA,EAAY,IAAIC,KAChBC,EAAQF,EAAUG,UAAY,EAC9BC,EAAYF,IAAAA,OAAAA,EAAUA,MAAAA,OAAAA,EAAQ,GAE9BG,EAA+C,SAAzCP,OAAOQ,aAAaC,QAAQ,SAAsBC,QAAQH,IAAM,OAWtEI,EAAYC,SAASZ,OAAOQ,aAAaC,QAAQ,cAAgB,KAAM,IAEvEI,EAAc,CAClBC,QAAQ,EACRC,KAAM,UACNC,OAAQ,WAWJC,MAAAA,EAAcC,IACZ,MACJC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EAAa,QACbC,EAAc,QACdC,GACElB,EAAImB,IAAI,CAACC,EAAKC,KACV,MAACC,EAAIC,GAAMH,EAAII,MAAM,KACvBD,GAAAA,EAAI,CACAE,MAAAA,EAAI,IAAIxC,KAAKD,GACT0C,OAAOJ,GACjBG,EAAEE,SAASL,GACXG,EAAEG,WAAWL,GACbH,EAAMK,EAAEI,mBAAmB,QAASlC,GAE/ByB,OAAAA,IAkBF,MAAA,CACLnB,KAAAA,EACAC,YAAAA,EACAC,IAAAA,EACAC,YAAAA,EACAE,QAAAA,EACAD,YAAAA,EACAE,WAAAA,EACAC,WAAAA,EACAC,WAAAA,EACAC,WAAAA,EACAC,cAAAA,EACAC,cAAAA,EACAC,WAAAA,EACAC,WAAAA,EACAgB,aA/BwB,CACxB,WACA,QACA,gBACA,iBACA,gBACA,oBACA,QACA,UACA,WACA,UACA,aACA,eAEqCf,EAAqB,GAkB1DG,WAAAA,EACAF,WAAAA,EACAC,YAAAA,IAIKc,SAAAA,GAAS,KAAEC,EAAF,WAAQC,GAAcC,GACtC7C,EAAI2C,EAAMC,EAAYC,GAChBC,MAAAA,EAAQpC,EAAWiC,EAAK,IACxBI,EAAWrC,EAAWiC,EAAK,IAAMA,EAAK,IACtCK,EAjFCC,SAAWC,EAAMC,EAAO,EAAGC,EAAO,GACnCjB,MAAAA,EAAQe,EAAKG,QAAQ,UAAW,IAAIlB,MAAM,UAC1CC,EAAI,IAAIxC,KAAKD,GAGZyC,OAFPA,EAAEE,SAASD,OAAOF,EAAM,IAAMgB,GAC9Bf,EAAEG,WAAWF,OAAOF,EAAM,IAAMiB,GACzBhB,EAAEI,mBAAmB,QAASlC,GAAa+C,QAAQ,UAAW,IA4EtDJ,CAAWH,EAAM7B,QAAS,EAAG,IAEtCqC,EAAmB,GAAA,OAAA,IAAI1D,KAC3BiD,GAAQ,IAAIjD,MAAO2D,cAAgBX,GACnCY,mBAAmB,QAAS,CAC5B1C,IAAK,UACL2C,KAAM,UACNC,MAAO,OACPlD,KAAM,UACNC,OAAQ,UACRkD,OAAQ,aAGJC,EAAoBd,GAAAA,OAAAA,EAAMjC,YAAeiC,KAAAA,OAAAA,EAAML,aAArD,YACMoB,EAAczB,IACZ,MAAC0B,EAAGC,GAAK3B,EACZiB,QAAQ,UAAW,IACnBlB,MAAM,KACNL,IAAIO,QACAyB,OAAI,GAAJA,EAASC,GAGZC,EAAa,CAACC,EAAQC,EAAQC,EAAS,EAAGC,EAAQ,EAAGC,KACnDC,MAAAA,EAAQ,GACRC,EAAMV,GAAW,IAAIjE,MAAO4C,mBAAmB,QAASlC,GAAakE,MAAM,EAAG,IAC9EC,EAAOZ,EAAWI,GAAUE,EAC5BO,EAAab,EAAWK,GACxBS,EAAKD,EAAaN,EAGjBE,OAFPA,EAAMM,KAAKH,GAAQF,GAAOA,EAAMI,EAAK,YAAc,IAC/CN,GAAQK,IAAeb,EAAWQ,IAAOC,EAAMM,KAAK,YACjDN,EAAMO,KAAK,OAIbC,EAAYC,EAAaC,EAAWC,EAAcC,GAAa,CACpElB,EAAWlB,EAAM/B,YAAa+B,EAAM9B,YAAa,GAAI,GACrDgD,EAAWlB,EAAM5B,WAAY4B,EAAM3B,WAAY,EAAG,IAClD6C,EAAWlB,EAAM1B,WAAY0B,EAAMzB,WAAY,EAAG,GAAI0B,EAAS1B,YAC/D2C,EAAWlB,EAAMxB,cAAewB,EAAMxB,cAAe,GAAI,IACzD0C,EAAWlB,EAAMtB,WAAYsB,EAAMrB,WAAY,EAAG,GAAIsB,EAAStB,aAE3D0D,EACJH,EAAUI,SAAS,aAAeF,EAAUE,SAAS,YAAc,UAAY,GAE3EC,EACkB/B,+BAAAA,OAAAA,EACAM,sCAAAA,OAAAA,EAQTkB,iLAAAA,OAAAA,EAAehC,MAAAA,OAAAA,EAAM/B,YAEH+B,0DAAAA,OAAAA,EAAM9B,YACR8B,8CAAAA,OAAAA,EAAMjB,WAMlBmB,iHAAAA,OAAAA,EAGbF,kDAAAA,OAAAA,EAAM7B,QAIJ6B,kDAAAA,OAAc,QAAdA,EAAMhC,IAAgB,QAAU,OAChCgC,qBAAAA,OAAAA,EAAM5B,WACe6D,0CAAAA,OAAAA,EAC3BjC,MAAAA,OAAc,QAAdA,EAAMhC,IAAgBgC,EAAMnB,WAAa,MAAQmB,EAAMlB,YAAckB,EAAM3B,WAKrE2B,+DAAAA,OAAAA,EAAM1B,WACa4D,wCAAAA,OAAAA,EAAclC,MAAAA,OAAAA,EAAMzB,WAId4D,2FAAAA,OAAAA,EAAiBnC,MAAAA,OAAAA,EAAMxB,cAIhDwB,+DAAAA,OAAAA,EAAMtB,WACa0D,wCAAAA,OAAAA,EAAcpC,MAAAA,OAAAA,EAAMrB,WAKzCqB,kGAAAA,OAAAA,EAAMnB,WAAgBmB,OAAAA,OAAAA,EAAMlB,YAKXuD,6EAAAA,OAAAA,EAtDvB,wDAwDkBG,SAASC,eAAe,aAEhCC,UAAYH,EAElBxC,GAAOyC,SAASG,cAAc,UAAUC,UAAUC,OAAO,SAG3DC,IAAAA,EAASC,KAAKC,MAAMrG,OAAOQ,aAAaC,QAAQ,iBAC9C6F,MAIAC,EAAS,IAAIC,IAAIX,SAASY,UAAUC,aACpCC,EAAUJ,EAAOK,IAAI,OAAS,+CAC9BC,EAAYN,EAAOK,IAAI,SAAW,iBAClCE,EAAMP,EAAOK,IAAI,OAEnB,IAACE,EAAK,OAAOpG,QAAQqG,MAAM,4CAEzBC,MAAAA,EAA8DL,iDAAAA,OAAAA,EAAkBE,YAAAA,OAAAA,EAAavG,KAAAA,OAAAA,EAAawG,SAAAA,OAAAA,GAChHvG,EAAI,CAAEyG,WAAAA,IAEAC,MAYAC,EAAS,KACP9D,MAAAA,EA3BQ,KACd+C,IACA,IAAIhG,MAAO2D,cAAciB,MAAM,EAAGpE,KAAewF,EAAOhD,WAAW4B,MAAM,EAAGpE,GAyB9D2F,GACdH,GAAUA,EAAOjD,MAAQD,EAASkD,EAAQ/C,GACrCA,GAfyB,KAC9B+D,MAAMH,GACHI,KAAMC,GAAQA,EAAIC,QAClBF,KAAMC,IACL9G,EAAI,CAAE8G,IAAAA,IACAnE,MAAAA,EAAOmE,EAAIE,OACXpE,GAAa,IAAIhD,MAAO2D,cAC9BqC,EAAS,CAAEjD,KAAAA,EAAMC,WAAAA,GACjBnD,OAAOQ,aAAagH,QAAQ,eAAgBpB,KAAKqB,UAAUtB,MAE5DuB,MAAMnH,GAKG0G,GAA0BG,KAAK,IAAMnE,EAASkD,GAAQ,KAEpEe,IACAlH,OAAO2H,YAAYT,EAAQ","file":"prayertimes.today.d79c844e.js","sourceRoot":"../src","sourcesContent":["import \"../styles/prayertimes.today.css\";\n\nwindow.onload = () => {\n  const dateToday = new Date();\n  const index = dateToday.getDate() + 1;\n  const range = `A${index}:R${index + 1}`;\n\n  const log = window.localStorage.getItem(\"debug\") === \"true\" ? console.log : () => {};\n\n  // poll frequency: download data from server with this frequency\n  // 8 - 11 = once a day\n  // 12 = twice a day\n  // 13 = every hour\n  // 14 = every half an hour\n  // 15 = every 10 minute\n  // 16 = every minute\n  // 18 = every 10 secs\n  // 19 = every 1 secs\n  const frequency = parseInt(window.localStorage.getItem(\"frequency\") || \"12\", 10);\n\n  const timeOptions = {\n    hour12: false,\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  };\n\n  function formatTime(time, incH = 0, incM = 0) {\n    const split = time.replace(/[^ -~]/g, \"\").split(/[\\:\\s]/);\n    const t = new Date(dateToday);\n    t.setHours(Number(split[0]) + incH);\n    t.setMinutes(Number(split[1]) + incM);\n    return t.toLocaleTimeString(\"en-GB\", timeOptions).replace(/[^ -~]/g, \"\");\n  }\n\n  const getRowData = (row) => {\n    const [\n      date,\n      islamicDate,\n      day,\n      fajarBegins,\n      fajarJamaat,\n      sunrise,\n      dhurBegins,\n      dhurJamaat,\n      asarBegins,\n      asarJamaat,\n      maghribBegins,\n      maghribJamaat,\n      ishaBegins,\n      ishaJamaat,\n      islamicMonthNumber,\n      firstJumah = \"12:30\",\n      secondJumah = \"13:10\",\n      unofficial,\n    ] = row.map((val, i) => {\n      const [hh, mm] = val.split(\":\");\n      if (mm) {\n        const t = new Date(dateToday);\n        const h = Number(hh);\n        t.setHours(hh);\n        t.setMinutes(mm);\n        val = t.toLocaleTimeString(\"en-GB\", timeOptions);\n      }\n      return val;\n    });\n    const islamicMonthNames = [\n      \"Muharram\",\n      \"Safar\",\n      \"Rabi al-Awwal\",\n      \"Rabi ath-Thani\",\n      \"Jumadi ul-Ula\",\n      \"Jumadi ul-Akhirah\",\n      \"Rajab\",\n      \"Sha‘ban\",\n      \"Ramadhan\",\n      \"Shawwal\",\n      \"Dhul-Qadah\",\n      \"Dhul-Hijjah\",\n    ];\n    const islamicMonth = islamicMonthNames[islamicMonthNumber - 1];\n\n    return {\n      date,\n      islamicDate,\n      day,\n      fajarBegins,\n      sunrise,\n      fajarJamaat,\n      dhurBegins,\n      dhurJamaat,\n      asarBegins,\n      asarJamaat,\n      maghribBegins,\n      maghribJamaat,\n      ishaBegins,\n      ishaJamaat,\n      islamicMonth,\n      unofficial,\n      firstJumah,\n      secondJumah,\n    };\n  };\n\n  function drawData({ data, dateString }, valid) {\n    log(data, dateString, valid);\n    const today = getRowData(data[0]);\n    const tomorrow = getRowData(data[1] || data[0]);\n    const ishraq = formatTime(today.sunrise, 0, 15);\n\n    const todaysDateStr = `${new Date(\n      valid ? new Date().toISOString() : dateString\n    ).toLocaleDateString(\"en-GB\", {\n      day: \"numeric\",\n      year: \"numeric\",\n      month: \"long\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      second: \"2-digit\",\n    })}`;\n\n    const islamicDateStr = `${today.islamicDate} ${today.islamicMonth} 1440 Hj`;\n    const timeToMins = (t) => {\n      const [h, m] = t\n        .replace(/[^ -~]/g, \"\")\n        .split(\":\")\n        .map(Number);\n      return h * 60 + m;\n    };\n\n    const calcStyles = (begins, jamaat, before = 0, after = 0, next) => {\n      const style = [];\n      const now = timeToMins(new Date().toLocaleTimeString(\"en-GB\", timeOptions).slice(0, 5));\n      const from = timeToMins(begins) - before;\n      const jamaatTime = timeToMins(jamaat);\n      const to = jamaatTime + after;\n      style.push(from <= now && now < to ? \"highlight\" : \"\");\n      if (next && jamaatTime !== timeToMins(next)) style.push(\"changing\");\n      return style.join(\" \");\n    };\n\n    // highlight which jamaat time it is now\n    const [sehriClass, dhuhurClass, asarClass, maghribClass, ishaClass] = [\n      calcStyles(today.fajarBegins, today.fajarJamaat, 30, 0),\n      calcStyles(today.dhurBegins, today.dhurJamaat, 0, 10),\n      calcStyles(today.asarBegins, today.asarJamaat, 0, 10, tomorrow.asarJamaat),\n      calcStyles(today.maghribBegins, today.maghribBegins, 10, 10),\n      calcStyles(today.ishaBegins, today.ishaJamaat, 0, 10, tomorrow.ishaJamaat),\n    ];\n    const legendClass =\n      asarClass.includes(\"changing\") || ishaClass.includes(\"changing\") ? \"visible\" : \"\";\n\n    const table = `\n<div class=\"date english\">${todaysDateStr}</div>\n<div class=\"date islamic\">${islamicDateStr}</div>\n<table class=\"table\">\n  <thead>\n    <tr><th>Salah</th><th>Begins</th><th>Jamaat</th></tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Fajar</td>\n      <td class=\"${sehriClass}\">${today.fajarBegins}</td>\n      <td>\n        <span class=\"fajar jamaat\">${today.fajarJamaat}</span>\n        <span class=\"unofficial\">${today.unofficial}</span>\n      </td>\n    </tr>\n    <tr>\n      <td>Sunrise</td>\n      <td colspan=2\n          data-text=\"${ishraq}\"\n          class=\"ishraq\"\n      >\n        ${today.sunrise}\n      </td>\n    </tr>\n    <tr>\n      <td>${today.day === \"Fri\" ? \"Jumah\" : \"Zuhr\"}</td>\n      <td>${today.dhurBegins}</td>\n      <td class=\"dhuhur jamaat ${dhuhurClass}\">${\n      today.day === \"Fri\" ? today.firstJumah + \" / \" + today.secondJumah : today.dhurJamaat\n    }</td>\n    </tr>\n    <tr>\n      <td>Asar</td>\n      <td>${today.asarBegins}</td>\n      <td class=\"asar jamaat ${asarClass}\">${today.asarJamaat}</td>\n    </tr>\n    <tr>\n      <td>Maghrib</td>\n      <td colspan=2 class=\"maghrib ${maghribClass}\">${today.maghribBegins}</td>\n    </tr>\n    <tr>\n      <td>Isha</td>\n      <td>${today.ishaBegins}</td>\n      <td class=\"isha jamaat ${ishaClass}\">${today.ishaJamaat}</td>\n    </tr>\n    <tr>\n      <td>Jumah</td>\n      <td class=\"jumah\" colspan=2>\n        ${today.firstJumah} / ${today.secondJumah}\n      </td>\n    </tr>\n  </tbody>\n</table>\n<div class=\"legend shine ${legendClass}\">• <span>Changing tomorrow</span></div>\n          `;\n    const table_div = document.getElementById(\"table_div\");\n    //log(\"table html calculated:\", table);\n    table_div.innerHTML = table;\n\n    if (valid) document.querySelector(\".shine\").classList.remove(\"shine\");\n  }\n\n  let stored = JSON.parse(window.localStorage.getItem(\"todays-times\"));\n  const isValid = () =>\n    stored &&\n    new Date().toISOString().slice(0, frequency) === stored.dateString.slice(0, frequency);\n\n  const params = new URL(document.location).searchParams;\n  const sheetId = params.get(\"id\") || \"1qS2o3JQ07qFkUXMBvEZVZ3E8Z_mk0jMXXhxJkQ35LR8\";\n  const sheetName = params.get(\"name\") || \"calc-formatted\";\n  const key = params.get(\"key\");\n\n  if (!key) return console.error(\"Error: No API Key provided in the params\");\n\n  const urlToFetch = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!${range}?key=${key}`;\n  log({ urlToFetch });\n\n  const fetchFreshDataAndUpdate = () =>\n    fetch(urlToFetch)\n      .then((res) => res.json())\n      .then((res) => {\n        log({ res });\n        const data = res.values;\n        const dateString = new Date().toISOString();\n        stored = { data, dateString };\n        window.localStorage.setItem(\"todays-times\", JSON.stringify(stored));\n      })\n      .catch(log);\n\n  const render = () => {\n    const valid = isValid();\n    stored && stored.data && drawData(stored, valid);\n    if (!valid) fetchFreshDataAndUpdate().then(() => drawData(stored, true));\n  };\n  render();\n  window.setInterval(render, 1000);\n};\n"]}