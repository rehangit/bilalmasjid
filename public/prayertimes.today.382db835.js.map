{"version":3,"sources":["scripts/prayertimes.today.js"],"names":["window","onload","dateToday","Date","index","getDate","range","log","localStorage","getItem","console","frequency","parseInt","timeOptions","hour12","hour","minute","getRowData","row","date","islamicDate","day","fajarBegins","fajarJamaat","sunrise","dhurBegins","dhurJamaat","asarBegins","asarJamaat","maghribBegins","maghribJamaat","ishaBegins","ishaJamaat","islamicMonthNumber","firstJumah","secondJumah","thirdJumah","unofficial","map","val","i","hh","mm","split","t","Number","setHours","setMinutes","toLocaleTimeString","islamicMonth","drawData","data","dateString","valid","today","tomorrow","ishraq","formatTime","time","incH","incM","replace","todaysDateStr","toISOString","toLocaleDateString","year","month","second","islamicDateStr","timeToMins","h","m","calcStyles","begins","jamaat","before","after","next","style","now","slice","from","jamaatTime","to","push","join","sehriClass","dhuhurClass","asarClass","maghribClass","ishaClass","legendClass","includes","table","document","getElementById","innerHTML","querySelector","classList","remove","stored","JSON","parse","isValid","params","URL","location","searchParams","sheetId","get","sheetName","key","error","urlToFetch","fetchFreshDataAndUpdate","render","fetch","then","res","json","values","setItem","stringify","catch","setInterval"],"mappings":"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","file":"prayertimes.today.382db835.js","sourceRoot":"../src","sourcesContent":["import \"../styles/prayertimes.today.css\";\n\nwindow.onload = () => {\n  const dateToday = new Date();\n  const index = dateToday.getDate() + 1;\n  const range = `A${index}:S${index + 1}`;\n\n  const log = window.localStorage.getItem(\"debug\") === \"true\" ? console.log : () => {};\n\n  // poll frequency: download data from server with this frequency\n  // 8 - 11 = once a day\n  // 12 = twice a day\n  // 13 = every hour\n  // 14 = every half an hour\n  // 15 = every 10 minute\n  // 16 = every minute\n  // 18 = every 10 secs\n  // 19 = every 1 secs\n  const frequency = parseInt(window.localStorage.getItem(\"frequency\") || \"12\", 10);\n\n  const timeOptions = {\n    hour12: false,\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  };\n\n  function formatTime(time, incH = 0, incM = 0) {\n    const split = time.replace(/[^ -~]/g, \"\").split(/[\\:\\s]/);\n    const t = new Date(dateToday);\n    t.setHours(Number(split[0]) + incH);\n    t.setMinutes(Number(split[1]) + incM);\n    return t.toLocaleTimeString(\"en-GB\", timeOptions).replace(/[^ -~]/g, \"\");\n  }\n\n  const getRowData = (row) => {\n    const [\n      date,\n      islamicDate,\n      day,\n      fajarBegins,\n      fajarJamaat,\n      sunrise,\n      dhurBegins,\n      dhurJamaat,\n      asarBegins,\n      asarJamaat,\n      maghribBegins,\n      maghribJamaat,\n      ishaBegins,\n      ishaJamaat,\n      islamicMonthNumber,\n      firstJumah = \"12:30\",\n      secondJumah = \"13:10\",\n      thirdJumah,\n      unofficial,\n    ] = row.map((val, i) => {\n      const [hh, mm] = val.split(\":\");\n      if (mm) {\n        const t = new Date(dateToday);\n        const h = Number(hh);\n        t.setHours(hh);\n        t.setMinutes(mm);\n        val = t.toLocaleTimeString(\"en-GB\", timeOptions);\n      }\n      return val;\n    });\n    const islamicMonthNames = [\n      \"Muharram\",\n      \"Safar\",\n      \"Rabi al-Awwal\",\n      \"Rabi ath-Thani\",\n      \"Jumadi ul-Ula\",\n      \"Jumadi ul-Akhirah\",\n      \"Rajab\",\n      \"Sha‘ban\",\n      \"Ramadhan\",\n      \"Shawwal\",\n      \"Dhul-Qadah\",\n      \"Dhul-Hijjah\",\n    ];\n    const islamicMonth = islamicMonthNames[islamicMonthNumber - 1];\n\n    return {\n      date,\n      islamicDate,\n      day,\n      fajarBegins,\n      sunrise,\n      fajarJamaat,\n      dhurBegins,\n      dhurJamaat,\n      asarBegins,\n      asarJamaat,\n      maghribBegins,\n      maghribJamaat,\n      ishaBegins,\n      ishaJamaat,\n      islamicMonth,\n      unofficial,\n      firstJumah,\n      secondJumah,\n      thirdJumah,\n    };\n  };\n\n  function drawData({ data, dateString }, valid) {\n    log(data, dateString, valid);\n    const today = getRowData(data[0]);\n    const tomorrow = getRowData(data[1] || data[0]);\n    const ishraq = formatTime(today.sunrise, 0, 15);\n\n    const todaysDateStr = `${new Date(\n      valid ? new Date().toISOString() : dateString\n    ).toLocaleDateString(\"en-GB\", {\n      day: \"numeric\",\n      year: \"numeric\",\n      month: \"long\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      second: \"2-digit\",\n    })}`;\n\n    const islamicDateStr = `${today.islamicDate} ${today.islamicMonth} 1442 Hj`;\n    const timeToMins = (t) => {\n      const [h, m] = t\n        .replace(/[^ -~]/g, \"\")\n        .split(\":\")\n        .map(Number);\n      return h * 60 + m;\n    };\n\n    const calcStyles = (begins, jamaat, before = 0, after = 0, next) => {\n      const style = [];\n      const now = timeToMins(new Date().toLocaleTimeString(\"en-GB\", timeOptions).slice(0, 5));\n      const from = timeToMins(begins) - before;\n      const jamaatTime = timeToMins(jamaat);\n      const to = jamaatTime + after;\n      style.push(from <= now && now < to ? \"highlight\" : \"\");\n      if (next && jamaatTime !== timeToMins(next)) style.push(\"changing\");\n      return style.join(\" \");\n    };\n\n    // highlight which jamaat time it is now\n    const [sehriClass, dhuhurClass, asarClass, maghribClass, ishaClass] = [\n      calcStyles(today.fajarBegins, today.fajarJamaat, 30, 0),\n      calcStyles(today.dhurBegins, today.dhurJamaat, 0, 10),\n      calcStyles(today.asarBegins, today.asarJamaat, 0, 10, tomorrow.asarJamaat),\n      calcStyles(today.maghribBegins, today.maghribBegins, 10, 10),\n      calcStyles(today.ishaBegins, today.ishaJamaat, 0, 10, tomorrow.ishaJamaat),\n    ];\n    const legendClass =\n      asarClass.includes(\"changing\") || ishaClass.includes(\"changing\") ? \"visible\" : \"\";\n\n    const table = `\n<div class=\"date english\">${todaysDateStr}</div>\n<div class=\"date islamic\">${islamicDateStr}</div>\n<table class=\"table\">\n  <thead>\n    <tr><th>Salah</th><th>Begins</th><th>Jamaat</th></tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Fajar</td>\n      <td class=\"${sehriClass}\">${today.fajarBegins}</td>\n      <td>\n        <span class=\"fajar jamaat\">${today.fajarJamaat}</span>\n        <span class=\"unofficial\">${today.unofficial}</span>\n      </td>\n    </tr>\n    <tr>\n      <td>Sunrise</td>\n      <td colspan=2\n          data-text=\"${ishraq}\"\n          class=\"ishraq\"\n      >\n        ${today.sunrise}\n      </td>\n    </tr>\n    <tr>\n      <td>${today.day === \"Fri\" ? \"Jumah\" : \"Zuhr\"}</td>\n      <td>${today.dhurBegins}</td>\n      <td class=\"dhuhur jamaat ${dhuhurClass}\">${\n      today.day === \"Fri\" ? today.firstJumah : today.dhurJamaat\n    }</td>\n    </tr>\n    <tr>\n      <td>Asar</td>\n      <td>${today.asarBegins}</td>\n      <td class=\"asar jamaat ${asarClass}\">${today.asarJamaat}</td>\n    </tr>\n    <tr>\n      <td>Maghrib</td>\n      <td colspan=2 class=\"maghrib ${maghribClass}\">${today.maghribBegins}</td>\n    </tr>\n    <tr>\n      <td>Isha</td>\n      <td>${today.ishaBegins}</td>\n      <td class=\"isha jamaat ${ishaClass}\">${today.ishaJamaat}</td>\n    </tr>\n    <tr>\n      <td>Jumah</td>\n      <td class=\"jumah\" colspan=2>\n        ${[today.firstJumah, today.secondJumah, today.thirdJumah].join(\" / \")}\n      </td>\n    </tr>\n  </tbody>\n</table>\n<div class=\"legend shine ${legendClass}\">• <span>Changing tomorrow</span></div>\n          `;\n    const table_div = document.getElementById(\"table_div\");\n    //log(\"table html calculated:\", table);\n    table_div.innerHTML = table;\n\n    if (valid) document.querySelector(\".shine\").classList.remove(\"shine\");\n  }\n\n  let stored = JSON.parse(window.localStorage.getItem(\"todays-times\"));\n  const isValid = () =>\n    stored &&\n    new Date().toISOString().slice(0, frequency) === stored.dateString.slice(0, frequency);\n\n  const params = new URL(document.location).searchParams;\n  const sheetId = params.get(\"id\") || \"1qS2o3JQ07qFkUXMBvEZVZ3E8Z_mk0jMXXhxJkQ35LR8\";\n  const sheetName = params.get(\"name\") || \"calc-formatted\";\n  const key = params.get(\"key\");\n\n  if (!key) return console.error(\"Error: No API Key provided in the params\");\n\n  const urlToFetch = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!${range}?key=${key}`;\n  log({ urlToFetch });\n\n  const fetchFreshDataAndUpdate = () =>\n    fetch(urlToFetch)\n      .then((res) => res.json())\n      .then((res) => {\n        log({ res });\n        const data = res.values;\n        const dateString = new Date().toISOString();\n        stored = { data, dateString };\n        window.localStorage.setItem(\"todays-times\", JSON.stringify(stored));\n      })\n      .catch(log);\n\n  const render = () => {\n    const valid = isValid();\n    stored && stored.data && drawData(stored, valid);\n    if (!valid) fetchFreshDataAndUpdate().then(() => drawData(stored, true));\n  };\n  render();\n  window.setInterval(render, 1000);\n};\n"]}