<html>
  <head>
    <link rel="stylesheet" href="./style.sheet.css" />
  </head>
  <body>
    <script type="text/javascript">
      window.onload = async () => {
        var [headers, rows] = await Promise.all([
          fetch(
            "https://spreadsheets.google.com/feeds/cells/1qS2o3JQ07qFkUXMBvEZVZ3E8Z_mk0jMXXhxJkQ35LR8/o1a4hmz/public/basic?alt=json&min-row=1&max-row=1"
          )
            .then(r => r.json())
            .then(json => json.feed.entry.map(e => e.content.$t)),
          fetch(
            "https://spreadsheets.google.com/feeds/list/1qS2o3JQ07qFkUXMBvEZVZ3E8Z_mk0jMXXhxJkQ35LR8/o1a4hmz/public/values?alt=json"
          )
            .then(r => r.json())
            .then(json =>
              json.feed.entry.map(e => [
                e.title.$t,
                ...e.content.$t.split(", ").map(i => i.split(": ")[1].trim())
              ])
            )
        ]);

        function insertCell(value, td = "td", i) {
          if (i !== 11 && i !== 14) {
            const [hh, mm] = value.split(":");
            if (i > 5 && mm) {
              const h = Number(hh);
              if (h < 12) value = h + 12 + ":" + mm;
            }
            return `<${td}>${value}</${td}>`;
          }
          return "";
        }

        function insertRow(row, className = "", td) {
          return `<tr class='${className}'>${row
            .map((c, i) => insertCell(c, td, i))
            .join("")}</tr>`;
        }

        const today = new Date().getDate();
        document.getElementById("prayer_times").innerHTML = `
          <table class='table'>
            <thead class="full">${insertRow(headers, "headerRow", "th")}</thead>
            <thead class="small">${insertRow(
              headers.map(w => w.replace(/\B[aeiou]/gi, "")),
              "headerRow",
              "th"
            )}</thead>
            <tbody>${rows
              .map(row =>
                insertRow(row, row[0] == today ? "selectedTableRow" : "")
              )
              .join("")}</tbody>
          </table>
        `;
      };
    </script>

    <div id="prayer_times"></div>
  </body>
</html>
