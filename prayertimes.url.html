<html>
  <head>
    <style>
      h2 {
        text-align: center;
      }
      body {
        margin: 0;
        font-family: Lato, "Trebuchet MS", "Lucida Sans Unicode", "Lucida Grande", "Lucida Sans",
          sans-serif;
      }

      .table {
        width: calc(100%-4px);
        text-align: center;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        border-collapse: collapse;
        margin: auto;
      }

      .friday {
        background-color: LIGHTCYAN;
        font-weight: bold;
      }
      .selectedTableRow {
        background-color: cadetblue;
        color: whitesmoke;
      }
      td,
      th {
        text-align: center;
        border: 0.25px rgba(128, 128, 128, 0.5) solid;
        padding: 4px 4px;
        font-size: inherit;
      }
      th:first-child,
      td:first-child {
        text-align: left;
      }

      @media only screen and (max-width: 600px) {
        td,
        th {
          font-size: small;
          padding: 2px 2px;
        }
      }

      .table thead th {
        background-color: darkolivegreen;
        color: white;
      }
      .table thead,
      .table thead th {
        position: sticky;
        position: -webkit-sticky;
        top: 0;
      }
    </style>
  </head>
  <body>
    <script type="text/javascript">
      window.onload = async () => {
        var [month, headers, rows] = await fetch(
          "https://sheets.googleapis.com/v4/spreadsheets/1qS2o3JQ07qFkUXMBvEZVZ3E8Z_mk0jMXXhxJkQ35LR8/values/calc-formatted!A:O?key=AIzaSyCq_9F8lfiTeXuj0RoPTrOg0NufmVf6qts"
        )
          .then(res => res.json())
          .then(json => {
            const headers = json.values[0];
            const month = headers[0];
            headers[0] = "Date";
            return [month, headers, json.values.slice(1)];
          });

        function insertCell(value, td = "td", i) {
          if (i !== 11 && i !== 14) {
            const [hh, mm] = value.split(":");
            if (i > 6 && mm) {
              const h = Number(hh);
              if (h < 12) value = h + 12 + ":" + mm;
            }
            return `<${td}>${value}</${td}>`;
          }
          return "";
        }

        function insertRow(row, className = "", td) {
          return `<tr class='${className}'>${row
            .map((c, i) => insertCell(c, td, i))
            .join("")}</tr>`;
        }

        const today = new Date().getDate();
        document.getElementById("prayer_times").innerHTML = `
          <h2>${month}</h2>
          <table class='table'>
            <thead>${insertRow(headers, "headerRow", "th")}</thead>
            <tbody>${rows
              .map(row => {
                const classNames = [];
                if (row[2] === "Fri") classNames.push("friday");
                if (row[0] == today) classNames.push("selectedTableRow");
                return insertRow(row, classNames.join(" "));
              })
              .join("")}</tbody>
          </table>
        `;
      };
    </script>

    <div id="prayer_times"></div>
  </body>
</html>
